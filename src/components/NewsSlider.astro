<!-----
<section class="w-full">
    <section class="flex flex-col items-center justify-center mt-36 min-h-screen w-full">
        <div class="relative overflow-hidden p-5">
            <h2 class="text-3xl px-10 font-bold text-gray-200 text-center">Novedades</h2>
            <button id="preBtn" class="w-10vw h-full absolute flex top-0 justify-center items-center cursor-pointer z-80 left-0"><img src="http://9.0.1.247:8081/images/arrow.png"></button>
            <button id="nxtBtn" class="w-10vw h-full absolute flex top-0 justify-center items-center cursor-pointer z-15 bg-gray-300 right-0"><img src="http://9.0.1.247:8081/images/arrow.png"></button>
            <div id="ultimasNoticias" class="py-5 px-10 flex flex-col sm:flex-col md:flex-row overflow-x-auto scroll-smooth scrollbar-none min-h-full w-auto gap-4 text-sky-300 justify-center">
                Aquí se cargarán dinámicamente las 3 noticias
            </div>
        </div>
    </section>
</section>

<script>
    interface Noticia {
        id: number;
        titulo: string;
        descripcion: string;
        tipo_contenido: string;
        contenido: string;
        fecha_creacion: string;
    }

    async function obtenerNoticias(): Promise<Noticia[]> {
        const response = await fetch('http://9.0.1.247:8081/noticias');

        if (!response.ok) {
            throw new Error('Error al obtener noticias');
        }

        const noticias = await response.json();
        return noticias;
    }

    document.addEventListener('DOMContentLoaded', async () => {
        const contenedorNoticias = document.getElementById('ultimasNoticias');

        try {
            const noticias = await obtenerNoticias();
            const ultimasTres = noticias.slice(0, 3);

            ultimasTres.forEach((noticia) => {
                const card = document.createElement('div');
                card.className = 'bg-blue-600/10 rounded-lg shadow-md overflow-hidden w-full max-w-sm mb-4 mx-2';
    
                const contenidoHTML = noticia.tipo_contenido === 'imagen' ? `
                    <img src="${noticia.contenido}" alt="Imagen de Noticia" class="object-contain w-full h-auto">
                ` : noticia.tipo_contenido === 'video' ? `
                    <video controls class="w-full h-48">
                        <source src="${noticia.contenido}" type="video/mp4">
                        Tu navegador no soporta videos.
                    </video>
                ` : `
                    <div class="w-full h-auto bg-gray-200 flex items-center justify-center text-gray-500 text-center p-4">
                        ${noticia.contenido}
                    </div>
                `;
    
                card.innerHTML = `
                    <div class="w-full bg-gray-200 overflow-hidden">
                        ${contenidoHTML}
                    </div>
                    <div class="p-4">
                        <h2 class="text-xl font-medium mb-2 text-gray-200">${noticia.titulo}</h2>
                        <p class="text-gray-200 text-sm mb-3">${noticia.descripcion}</p>
                        <p class="text-gray-400 text-sm mt-2">${new Date(noticia.fecha_creacion).toLocaleDateString()}</p>
                    </div>
                `;
                contenedorNoticias?.appendChild(card);
            });
        } catch (error) {
            console.error('Error cargando noticias:', error);
        }
    });
</script>

----->

<section class="w-full">
    <section class="flex flex-col items-center justify-center mt-36 min-h-screen w-full">
      <div class="relative overflow-hidden px-[10vw] py-5 w-full">
        <h2 class="text-3xl font-bold text-gray-200 text-center mb-4">Novedades</h2>
  
        <button id="preBtn" class="pre-btn absolute left-0 h-32 w-[10vw] flex justify-center items-center z-10 rotate-180 cursor-pointer bg-gray-300">
          <img src="http://9.0.1.247:8081/images/arrow.png" class="opacity-20 hover:opacity-100 transition-opacity duration-200">
        </button>
  
        <button id="nxtBtn" class="nxt-btn absolute right-0 h-32 w-[10vw] flex justify-center items-center z-10 cursor-pointer bg-gray-300">
          <img src="http://9.0.1.247:8081/images/arrow.png" class="opacity-20 hover:opacity-100 transition-opacity duration-200">
        </button>
  
        <div id="ultimasNoticias" class="flex overflow-x-auto gap-4 scroll-smooth scrollbar-none">
          <!-- Aquí se cargarán dinámicamente las noticias -->
        </div>
      </div>
    </section>
</section>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
      const contenedor = document.getElementById('ultimasNoticias') as HTMLElement;
      const preBtn = document.getElementById('preBtn') as HTMLElement
      const nxtBtn = document.getElementById('nxtBtn') as HTMLElement
    
      interface Noticia {
        id: number;
        titulo: string;
        descripcion: string;
        tipo_contenido: string;
        contenido: string;
        fecha_creacion: string;
    }

        async function obtenerNoticias(): Promise<Noticia[]> {
        const res = await fetch('http://9.0.1.247:8081/noticias');
        if (!res.ok) throw new Error('Error al obtener noticias');
        const data: Noticia[] = await res.json()
        return data;
        }
    
      try {
        const noticias = await obtenerNoticias();
        const ultimasNueve = noticias.slice(0, 9);
    
        ultimasNueve.forEach((noticia) => {
          const card = document.createElement('div');
          card.className = 'bg-blue-600/10 rounded-lg shadow-md overflow-hidden w-72 min-w-[18rem] flex-shrink-0';
          
          const contenidoHTML = noticia.tipo_contenido === 'imagen' ? `
            <img src="${noticia.contenido}" alt="Imagen de Noticia" class="object-contain w-full h-48">
          ` : noticia.tipo_contenido === 'video' ? `
            <video controls class="w-full h-48">
              <source src="${noticia.contenido}" type="video/mp4">
            </video>
          ` : `
            <div class="w-full h-auto bg-gray-200 flex items-center justify-center text-gray-500 text-center p-4">
              ${noticia.contenido}
            </div>
          `;
    
          card.innerHTML = `
            <div class="w-full bg-gray-200 overflow-hidden">
              ${contenidoHTML}
            </div>
            <div class="p-4">
              <h2 class="text-xl font-medium mb-2 text-gray-200">${noticia.titulo}</h2>
              <p class="text-gray-200 text-sm mb-3">${noticia.descripcion}</p>
              <p class="text-gray-400 text-sm mt-2">${new Date(noticia.fecha_creacion).toLocaleDateString()}</p>
            </div>
          `;
          contenedor?.appendChild(card);
        });
    
        // Slider funcionalidad
        const scrollAmount = contenedor.offsetWidth;
        preBtn.addEventListener('click', () => {
          contenedor.scrollLeft -= scrollAmount;
        });
        nxtBtn.addEventListener('click', () => {
          contenedor.scrollLeft += scrollAmount;
        });
    
      } catch (error) {
        console.error('Error cargando noticias:', error);
      }
    });   
</script>
