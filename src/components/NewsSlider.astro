<section class="w-full">
    <section class="flex flex-col items-center justify-center mt-28 w-full">
      <div class="relative overflow-hidden px-[10vw] py-5 w-full max-w-[1920px] h-full">
        <span class="flex justify-center items-center mb-10 animate-fade-in animate-delay-100">
          <h2 class="text-5xl font-black text-white mr-3">Novedades de </h2>
          <div id="mesActual" class="text-5xl font-black text-[#00d0fe]"></div>
        </span>
  
        <button id="preBtn" class="pre-btn absolute top-1/2 -translate-y-1/2 left-3 h-14 w-14 flex justify-center items-center z-10 rounded-4xl bg-gray-200 rotate-180 cursor-pointer animate-fade-in animate-delay-150 hover:bg-[#00d0fe] transition duration-200">
          <img src="/images/arrow.png" class="opacity-100">
        </button>
  
        <button id="nxtBtn" class="nxt-btn absolute top-1/2 -translate-y-1/2 right-5 h-14 w-14 flex justify-center items-center z-10 rounded-4xl bg-gray-200 cursor-pointer animate-fade-in animate-delay-150 hover:bg-[#00d0fe] transition duration-200">
          <img src="/images/arrow.png" class="opacity-100">
        </button>
  
        <div id="ultimasNoticias" class="flex overflow-x-auto gap-4 scroll-smooth scrollbar-none animate-fade-in animate-delay-150">
          <!-- Aquí se cargarán dinámicamente las noticias -->
        </div>
      </div>
    </section>
</section>

<script>
  const URLBACK=import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:4321'
    document.addEventListener('DOMContentLoaded', async () => {
      const contenedor = document.getElementById('ultimasNoticias') as HTMLElement
      const preBtn = document.getElementById('preBtn') as HTMLElement
      const nxtBtn = document.getElementById('nxtBtn') as HTMLElement
    
      interface Noticia {
        id: number
        titulo: string
        descripcion: string
        tipo_contenido: string
        contenido: string
        fecha_creacion: string
    }

    async function obtenerNoticias(): Promise<Noticia[]> {
        const res = await fetch(`${URLBACK}/noticias`, {
            credentials: 'include' // Incluye cookies en la solicitud
        })
        if (!res.ok) throw new Error('Error al obtener noticias')
        const data: Noticia[] = await res.json()
        return data
    }
    
    try {
      const noticias = await obtenerNoticias()
      const ultimasNueve = noticias.slice(0, 9)
    
      ultimasNueve.forEach((noticia) => {
        const card = document.createElement('div')
        card.className = 'shadow-md overflow-hidden w-72 min-w-[18rem] flex-shrink-0'
          
        let contenidoHTML = ""

        if (noticia.tipo_contenido === 'imagen') {
          contenidoHTML = `
          <img src="${noticia.contenido}" alt="Imagen de Noticia" class="object-cover w-full h-64">
          `
        } else if (noticia.tipo_contenido === 'video') {
          contenidoHTML = `
              <video controls class="w-full h-64">
                  <source src="${noticia.contenido}" type="video/mp4">
                  Tu navegador no soporta videos.
              </video>
          `
        } else if (noticia.tipo_contenido === 'texto') {
          contenidoHTML = `
            <div class="w-full h-64 flex items-center justify-center
            text-2xl text-blue-600 font-semibold text-center p-4">
            <a href="${noticia.contenido}" target="_blank" class="hover:underline"><img src="/images/LogoBanner.png" class="object-contain w-full h-auto">Lea aquí</a>
            </div>
            `
        }
    
        card.innerHTML = `
            <div class="w-full overflow-hidden rounded-t-2xl">
              ${contenidoHTML}
            </div>
            <div class="p-4 bg-black/25 rounded-b-2xl">
              <h2 class="text-xl font-bold mb-2 text-gray-200">${noticia.titulo}</h2>
              <p class="text-gray-400 text-sm mt-2">${new Date(noticia.fecha_creacion).toLocaleDateString()}</p>
            </div>
          `
          contenedor?.appendChild(card)
        })
    
        // Slider funcionalidad
        const scrollAmount = contenedor.offsetWidth/3
        preBtn.addEventListener('click', () => {
          contenedor.scrollLeft -= scrollAmount
        })
        nxtBtn.addEventListener('click', () => {
          contenedor.scrollLeft += scrollAmount
        })
    
      } catch (error) {
        console.error('Error cargando noticias:', error)
      }

      function mes(){
        const mesActual = new Date().toLocaleDateString('es-ES', { month: 'long' })
        const spanMes = document.getElementById("mesActual")
        if (spanMes) {
          // Capitalizamos la primera letra del mes (por si acaso viene en minúscula)
          spanMes.textContent = mesActual.charAt(0).toUpperCase() + mesActual.slice(1)
        }
      }
      mes() 
      setInterval(mes, 60000) // Actualiza el mes cada minuto
    })
</script>
