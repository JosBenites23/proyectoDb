<div>
    <div id="contenedor-Links"></div>
</div>

<script>

    declare global {
        interface Window {
            eliminarLink: (id: number) => Promise<void>;
        }
    }

    const URL = import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:8081';
    interface Link{
        id: number
        name: string
        link: string
    }
    
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            await verificarToken()
            cargarLink()
        } catch (error) {
            console.error('Error al cargar links:', error);
        }
    });

    
    async function cargarLink(){
        const response = await fetch(`${URL}/links/`);
        const links:Link[] = await response.json();

        const contenedor = document.querySelector('#contenedor-Links') as HTMLElement;
        contenedor.innerHTML = '';
        
        links.forEach((link) => {
            const card = document.createElement('div');
            card.className = 'p-4 border rounded-lg shadow-md mb-4 bg-white';
            card.innerHTML = `
                <h2 class="font-bold text-lg">${link.name}</h2>
                ${tokenValido ? `<button onclick="eliminarEmpresa(${link.id})" class="bg-red-500 text-white px-4 py-2 rounded cursor-pointer hover:bg-red-800 transition duration-300 ease-in-out">Eliminar</button>` : ""}
            `;
            contenedor.appendChild(card);
        });
    }

    async function eliminarLink(id: number) {
        const response = await fetch(`${URL}/eliminar-link/${id}`, {
            method: 'DELETE',
            credentials: 'include' // Incluye cookies en la solicitud
        });

        if (response.ok) {
            alert('link eliminada');
            cargarLink(); // Recargar las empresas
        } else {
            alert('Error al eliminar la link');
        }
    }

    window.eliminarLink = eliminarLink;

    let tokenValido = false

    async function verificarToken() {
            try {
                const response = await fetch(`${URL}/protegida`, {
                    credentials: 'include' // Incluye cookies en la solicitud
                });

                tokenValido = response.ok;
            } catch (error) {
                tokenValido = false;
                console.error('Error al verificar el token:', error);
            }
        }
</script>
