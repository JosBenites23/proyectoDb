<div>
    <div id="contenedor-col"></div>
</div>

<script>

    declare global {
        interface Window {
            eliminarCol: (id: number) => Promise<void>
        }
    }

    const URL = import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:8081'
    interface Team {
        id: number
        descripcion: string
        contenido: string
    }
    
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            await verificarToken()
            cargarCol()
        } catch (error) {
            console.error('Error al cargar colaboradores:', error)
        }
    })

    
    async function cargarCol(){
        const response = await fetch(`${URL}/team/`)
        const col:Team[] = await response.json()
        
        col.sort((a, b) => b.id - a.id)
        
        const contenedor = document.querySelector('#contenedor-col') as HTMLElement
        contenedor.innerHTML = ''
        
        col.forEach((col) => {
            const card = document.createElement('div')
            card.className = 'p-4 border rounded-lg shadow-md mb-4 bg-white'
            card.innerHTML = `
                <img src="${col.contenido}" alt="imagen de empresa" class="w-32 h-auto object-contain rounded-lg">
                <p class="text-gray-700">${col.descripcion}</p>
                ${tokenValido ? `<button onclick="eliminarCol(${col.id})" class="bg-red-500 text-white px-4 py-2 rounded cursor-pointer hover:bg-red-800 transition duration-300 ease-in-out">Eliminar</button>` : ""}
            `;
            contenedor.appendChild(card)
        })
    }

    async function eliminarCol(id: number) {
        const response = await fetch(`${URL}/eliminar-col/${id}`, {
            method: 'DELETE',
            credentials: 'include' // Incluye cookies en la solicitud
        })

        if (response.ok) {
            alert('colaboradores eliminados')
            cargarCol() // Recargar las noticias
        } else {
            alert('Error al eliminar la colaboradores')
        }
    }

    window.eliminarCol = eliminarCol

    let tokenValido = false

    async function verificarToken() {
        try {
            const response = await fetch(`${URL}/protegida`, {
                credentials: 'include' // Incluye cookies en la solicitud
            })

            tokenValido = response.ok
        } catch (error) {
            tokenValido = false
            console.error('Error al verificar el token:', error)
        }
    }
</script>
