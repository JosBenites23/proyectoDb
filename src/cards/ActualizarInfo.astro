<form id="aboutForm" class="flex flex-col items-center justify-center w-full h-auto px-5 py-5">
    <input id="anio1" type="text" placeholder="año de creación" class="border-2 border-gray-200 w-full rounded-md p-2 mb-3 text-gray-800 bg-white"/>
    <label class="mb-2 text-white font-black">Imagen antigua</label>
    <input id="imagen1" type="file" accept="image/*" class="file:bg-blue-500 file:text-white file:font-semibold file:border-none file:rounded file:px-4 file:py-2 text-gray-200 mb-4 file:cursor-pointer"/>
    <input id="anio2" type="text" placeholder="año de creación" class="border-2 border-gray-200 w-full rounded-md p-2 mb-3 text-gray-800 bg-white"/>
    <label class="mb-2 text-white font-black">Imagen actual</label>
    <input id="imagen2" type="file" accept="image/*" class="file:bg-blue-500 file:text-white file:font-semibold file:border-none file:rounded file:px-4 file:py-2 text-gray-200 mb-4 file:cursor-pointer"/>
    <textarea id="historia"
        placeholder="Historia" 
        class="border-2 border-gray-200 rounded-md p-2 mb-3 text-gray-800 bg-white w-full min-h-32"></textarea>
    <textarea id="mision"
        placeholder="Misión" 
        class="border-2 border-gray-200 rounded-md p-2 mb-3 text-gray-800 bg-white w-full min-h-32"></textarea>
    <textarea id="vision"
        placeholder="Visión" 
        class="border-2 border-gray-200 rounded-md p-2 mb-3 text-gray-800 bg-white w-full min-h-32"></textarea>
    <textarea id="presencia"
        placeholder="Presencia" 
        class="border-2 border-gray-200 rounded-md p-2 mb-3 text-gray-800 bg-white w-full min-h-32"></textarea>
    <label class="mb-2 text-white font-black">Imagen de presencia</label>
    <input id="imagen3" type="file" accept="image/*" class="file:bg-blue-500 file:text-white file:font-semibold file:border-none file:rounded file:px-4 file:py-2 text-gray-200 mb-4 file:cursor-pointer"/>
    <div>
        <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300 cursor-pointer">Actualizar Información</button>            
        <a class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300 cursor-pointer" href="/InfoPage">ver</a>
    </div>
</form>

<script>
    const URLBACK = import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:4321'

    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('aboutForm') as HTMLFormElement | null
        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault()

                const historia = (document.getElementById('historia') as HTMLTextAreaElement).value.trim()
                const mision = (document.getElementById('mision') as HTMLTextAreaElement).value.trim()
                const vision = (document.getElementById('vision') as HTMLTextAreaElement).value.trim()
                const presencia = (document.getElementById('presencia') as HTMLTextAreaElement).value.trim()

                const anio1 = (document.getElementById('anio1') as HTMLInputElement).value.trim()
                const anio2 = (document.getElementById('anio2') as HTMLInputElement).value.trim()

                const imagen1 = (document.getElementById('imagen1') as HTMLInputElement).files?.[0]
                const imagen2 = (document.getElementById('imagen2') as HTMLInputElement).files?.[0]
                const imagen3 = (document.getElementById('imagen3') as HTMLInputElement).files?.[0]

                const formData = new FormData()

                if (historia) formData.append('historia', historia)
                if (mision) formData.append('mision', mision)
                if (vision) formData.append('vision', vision)
                if (presencia) formData.append('presencia', presencia)

                if (anio1) formData.append('anio', anio1)
                if (anio2) formData.append('anio2', anio2)

                if (imagen1) formData.append('imagen', imagen1)
                if (imagen2) formData.append('imagen2', imagen2)
                if (imagen3) formData.append('imagen3', imagen3)

                if ([...formData.entries()].length === 0) {
                    alert('No se ha modificado ningún campo.')
                    return
                }

                const res = await fetch(`${URLBACK}/about/`, {
                    method: 'PUT',
                    credentials: 'include',
                    body: formData
                })

                if (res.ok) {
                    alert('Información actualizada con éxito.')
                    form.reset(); // Opcional: limpia los campos
                } else {
                    alert('Error al actualizar la información.')
                }
            })
        }
    })


</script>