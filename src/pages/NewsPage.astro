---
import Layout from "../layouts/Layout.astro"
import Birthday from "../components/Birthday.astro"
---
<Layout showFooter={false}>
    <section class="w-full h-auto flex flex-col items-center justify-center mt-32">
        <div class="flex text-5xl font-black ">
            <h1 class="text-white mr-3">Novedades y </h1>
            <h1 class="text-[#00d0fe]">Cumpleaños</h1>
        </div>
        <!-- 
            <Birthday />
        -->
    </section>
    <section class="w-full justify-center justify-items-center">
        <section id="contenedorNoticias" class="min-h-screen max-w-[1920px] mt-5 py-5 px-10 grid lg:grid-cols-4 md:grid-cols-2 sm:grid-cols-1  gap-4 text-sky-300 justify-items-center">

        </section>
    </section>

    <script>
        const URLBACK=import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost'
        interface Noticia {
            id: number
            titulo: string
            descripcion: string
            tipo_contenido: string
            contenido: string
            fecha_creacion: string
        }       
    
        async function cargarNoticias() {
            const response = await fetch(`${URLBACK}/noticias`, {
                credentials: 'include'
            })
            if (!response.ok) {
                console.error('Error al obtener noticias')
                return
            }
            
            const noticias: Noticia[] = await response.json()
    
            // Ordenar por fecha más reciente primero
            noticias.sort((a, b) => new Date(b.fecha_creacion).getTime() - new Date(a.fecha_creacion).getTime())
    
            const contenedorNoticias = document.getElementById('contenedorNoticias') as HTMLElement
            contenedorNoticias.innerHTML = ''
    
            noticias.forEach((noticia) => {
                const card = document.createElement('div')
                card.className = 'shadow-md overflow-hidden w-full max-w-sm mb-4 mx-2'
    
                let contenidoHTML = ""

                if (noticia.tipo_contenido === 'imagen') {
                    contenidoHTML = `
                        <a href="${noticia.contenido}" target="_blank" class="block hover:scale-105 transition duration-200">
                            <img src="${noticia.contenido}" alt="Imagen de Noticia" class="object-cover w-full h-64">
                        </a>
                    `
                } else if (noticia.tipo_contenido === 'video') {
                    contenidoHTML = `
                        <video controls class="w-full h-64">
                            <source src="${noticia.contenido}" type="video/mp4">
                            Tu navegador no soporta videos.
                        </video>
                    `
                } else if (noticia.tipo_contenido === 'texto') {
                    contenidoHTML = `
                        <div class="w-full h-64 flex items-center justify-center text-2xl text-blue-600 font-semibold text-center p-4">
                        <a href="${noticia.contenido}" target="_blank" class="hover:underline"><img src="/images/LogoBanner.png" class="object-contain w-full h-auto">Lea aquí</a>
                        </div>
                    `
                }
    
                card.innerHTML = `
                    <div class=" h-auto w-full overflow-hidden rounded-t-2xl">
                        ${contenidoHTML}
                    </div>
                    <div class="p-4 bg-black/25 rounded-b-2xl">
                        <h2 class="text-xl font-medium mb-2 text-gray-200">${noticia.titulo}</h2>
                        <p class="text-gray-200 text-sm mb-3">${noticia.descripcion}</p>
                    </div>
                `
    
                contenedorNoticias.appendChild(card)
            })
        }

        document.addEventListener('DOMContentLoaded', async () => {
            cargarNoticias()
        })
    </script>
    
</Layout>